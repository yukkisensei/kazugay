name: yukki Ci test

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-24.04
    timeout-minutes: 120

    steps:
      - uses: actions/checkout@v4

      - name: Install deps + Clang 18
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y -qq \
            git curl wget unzip build-essential software-properties-common \
            cmake pkg-config python3 python3-pip gnupg meson ninja-build \
            libwayland-dev wayland-protocols libxkbcommon-dev libseat-dev \
            libdrm-dev libgles2-mesa-dev libpixman-1-dev libvulkan-dev \
            libxcb1-dev libxcb-composite0-dev libxcb-xfixes0-dev \
            libxcb-render0-dev libxcb-icccm4-dev libxcb-image0-dev \
            libxcb-util-dev libxcb-ewmh-dev libxcb-present-dev \
            libxcb-damage0-dev libxcb-randr0-dev libxcb-xinput-dev \
            libxcb-xinerama0-dev libxcb-xkb-dev libpugixml-dev hwdata \
            xwayland dbus-x11 openssl swaybg waybar kitty \
            libgbm-dev libudev-dev libevdev-dev libmtdev-dev \
            libluajit-5.1-dev libwacom-dev libgtk-3-dev libzip-dev librsvg2-dev \
            ccache

          wget -q https://apt.llvm.org/llvm.sh
          chmod +x llvm.sh
          sudo ./llvm.sh 18
          echo "CC=ccache clang-18" >> $GITHUB_ENV
          echo "CXX=ccache clang++-18" >> $GITHUB_ENV

      - name: Build Hyprland (auto deps)
        run: |
          git clone --recursive https://github.com/hyprwm/Hyprland.git
          cd Hyprland
          sudo -E ./scripts/compile.sh --install
